+++
draft = false
title = "Et si on semait le chaos chez ceux qui nous espionnent ?"
date = 2018-03-04T15:32:03+01:00
slug = "chrome-extension-navigateur-vie-privee"
tags = ["privacy","golang","google", "open-source","web extension", "khao"]
categories = ["devlogs"]
thumbnail = "images/2018/03/4/khao.png"
toc = true # Optional
+++

Il y Ã  une dizaine de jours une idÃ©e folle mâ€™a traversÃ© lâ€™esprit: et si on essayait dâ€™embrouiller les diffÃ©rents services chargÃ©s de nous espionner lorsque lâ€™on navigue sur internet. Ce week-end jâ€™ai trouvÃ© un peu de temps pour coder un proof of concept. Je vais dans ce billet vous expliquer le pourquoi, le comment et mÃªme vous proposer de tester le bidule.

<div  align="center">
<blockquote  class="twitter-tweet"  data-lang="fr"><p  lang="fr"  dir="ltr">ğŸ•µï¸â€â™‚ï¸ Ca pourrait Ãªtre interessant de crÃ©er un proxy qui mÃ©langerait Ã  la volÃ©e, entre les utilisateurs, les cookies issus des diffÃ©rentes rÃ©gies de pub et autres traqueurs. <a  href="https://twitter.com/hashtag/Id%C3%A9eDuJour?src=hash&amp;ref_src=twsrc%5Etfw">#IdÃ©eDuJour</a>  <a  href="https://twitter.com/hashtag/RGPD?src=hash&amp;ref_src=twsrc%5Etfw">#RGPD</a>  <a  href="https://twitter.com/hashtag/vieprivee?src=hash&amp;ref_src=twsrc%5Etfw">#vieprivee</a>  <a  href="https://twitter.com/hashtag/privacy?src=hash&amp;ref_src=twsrc%5Etfw">#privacy</a></p>&mdash; S.Ãepierrepont (@poroot) <a  href="https://twitter.com/poroot/status/967435868876296194?ref_src=twsrc%5Etfw">24 fÃ©vrier 2018</a></blockquote>
<script  async  src="https://platform.twitter.com/widgets.js"  charset="utf-8"></script>
</div>

## Tu veux un cookie ?

![pervers](/images/2018/03/4/pervert.gif#center)

Quand vous visitez un site, votre navigateur va envoyer des requÃªtes vers diffÃ©rents services/serveurs. Dans de trÃ¨s nombreux cas, la rÃ©ponse va contenir une directive demandant au navigateur de stocker des informations. Informations que le navigateur enverra dans chaque nouvelle requÃªte vers le service concernÃ©.

Voila en gros le fonctionnement des cookies.

Parfois ces cookies sont lÃ©gitimes, ils permettent par exemple de stocker des informations de connexions, ce qui vous Ã©vite dâ€™avoir Ã  vous authentifier Ã  chaque changement de page, mais bien souvent le but est de vous tracer afin dâ€™extraire un maximum dâ€™informations possibles vous concernant. Le but final Ã©tant - entre autre - de mieux cibler les publicitÃ©s qui vous seront affichÃ©es.

## Pour vivre heureux vivons cachÃ©sâ€¦ ou pas.

Vous allez me dire que vous avez une extension qui bloque les pubs et les diffÃ©rentes requÃªtes vers les service de â€œprofilageâ€. TrÃ¨s bien mais ce nâ€™est pas suffisant, de nombreuses requÃªtes comportant des cookies de tracking vont quand mÃªme passer. Si vous en doutez ouvrez les â€œdevtoolsâ€ de votre navigateur et regardez de plus prÃ¨s les cookies dans les requÃªtes que vous envoyez. Vous verrez que tous nâ€™ont pas pour unique but de vous faciliter la navigationâ€¦

Alors si au lieu de se cacher on se dÃ©guisait en quelquâ€™un dâ€™autre ?

- Ã§a nous anonymiserait (en partie au moinsâ€¦)
- Ã§a invaliderait nos profiles puisque dâ€™autres personnes ayant dâ€™autres centres dâ€™intÃ©rÃªts navigueraient en utilisant nos cookies.
- Ã§a mettrait la pagaille dans les bases de donnÃ©es de ceux qui nous profilent.

## Ok mais comment peut on faire ?

Et câ€™est lÃ  que Ã§a se complique un peu.

A lâ€™origine, jâ€™ai pensÃ© Ã  utiliser un proxy qui va rÃ©-Ã©crire les headers HTTP Ã  la volÃ©e. Cette solution prÃ©sente lâ€™avantage de centraliser lâ€™Ã©change de cookies entre les diffÃ©rents utilisateurs et ainsi de minimiser la latence induite par cet Ã©change. Par contre Ã§a Ã  de sacrÃ©s inconvÃ©nients, en premier lieu il faut que le proxy voit le trafic HTTPS chiffrÃ©, ce qui implique quâ€™il faut avoir une confiance absolue dans celui qui maintient le proxy. Ensuite câ€™est assez laborieux Ã  mettre en place pour lâ€™utilisateur, surtout si il faut installer le certificat du proxy pour ne pas faire couiner les navigateurs. Enfin Ã§a peut vite couter une fortune en bande passante...

Sachant que plus il y aura de participants plus le systÃ¨me sera efficace (plus de mÃ©lange), cette premiÃ¨re idÃ©e, de part sa difficultÃ© de mise en place pour l'utilisateur, nâ€™Ã©tait pas idÃ©ale.

Du coup jâ€™ai suivi la suggestion de Martin:

<div  align="center">
<blockquote  class="twitter-tweet"  data-conversation="none"  data-lang="fr"><p  lang="fr"  dir="ltr">Cela risque d&#39;Ãªtre difficile, au niveau du proxy, du fait du HTTPS. C&#39;est peut-Ãªtre plus simple cÃ´tÃ© navigateur, dans une extension ? ğŸ™ƒ</p>&mdash; Martin (@martin1975) <a  href="https://twitter.com/martin1975/status/967438946337808395?ref_src=twsrc%5Etfw">24 fÃ©vrier 2018</a></blockquote>
<script  async  src="https://platform.twitter.com/widgets.js"  charset="utf-8"></script>
</div>

## Comment Ã§a marche ?

Pour ce POC je me suis focalisÃ© sur le cookie **_ga** de google analytics. Ce cookie permet de vous suivre au cours des diffÃ©rentes pages vues et visites que vous allez faire sur un site. Pourquoi celui lÃ  ? Parce quâ€™il en fallait un que lâ€™on rencontre trÃ¨s souvent. On ne sera pas des millions Ã  tester dans un premier temps donc autant maximiser les chances de pouvoir faire des Ã©changes.

Un fois lâ€™extension installÃ©e (voir plus bas), elle va intercepter chaque requÃªte pour voir si elle contient le cookie â€œ_gaâ€. Si oui elle va demander au serveur central si il a un autre cookie correspondant au mÃªme domaine. Si câ€™est le cas lâ€™extension va rÃ©-Ã©crire la requÃªte pour utiliser ce nouveau cookie.

Cette solution nâ€™est pas idÃ©ale non plus, les plus perspicaces auront vu deux points qui peuvent poser problÃ¨me:

- la latence que cela va induire. Si Ã  chaque requÃªte il faut exÃ©cuter une autre requÃªte Ã§a va forcÃ©ment ralentir la navigation. Jâ€™ai limitÃ© ce problÃ¨me de deux faÃ§ons: cotÃ© serveur, en utilisant un systÃ¨me de stockage et â€œdâ€™indexationâ€ plutot vÃ©loce avec [Boltdb](https://github.com/coreos/bbolt) et au niveau de lâ€™extension jâ€™ai implÃ©mentÃ© un cache qui va garder le nouveau cookie au chaud pendant un certain dÃ©lais (pour le moment 15 minutes mais on peut imaginer que ce delais s'adapte Ã  la ressource dispo cotÃ© serveur...).
Au final, si le cookie est en cache, la latence nâ€™est pas perceptible, si il ne lâ€™est pas et donc si lâ€™extension doit faire une requÃªte au serveur central câ€™est tout Ã  fait acceptable puisque lâ€™on a une latence induite qui dans la majoritÃ© des cas infÃ©rieure Ã  100ms. Dans la pratque, de mon cotÃ© je ne sens pas cette latence.
- si cette idÃ©e fait son chemin il va falloir mettre a disposition pas mal de ressources pour rÃ©pondre Ã  la masse de requÃªtesâ€¦ mais bon on en est pas lÃ  ;)

Donc pas idÃ©ale mais c'est, pour le moment, le meilleur compromis. 

## On peut essayer ?

Et comment ! Nous seulement vous pouvez, mais je compte sur vous pour le faire.

Comment ?

Il vous suffit dâ€™installer lâ€™extension sur votre navigateur.

Pour le moment je ne la mets pas sur les diffÃ©rents â€œstoresâ€, câ€™est trop tÃ´t, donc il vous faudra lâ€™installer â€œÃ  la mainâ€, mais ne vous inquiÃ©tez pas comme vous allez voir plus bas, câ€™est trÃ¨s simple.

Une prÃ©cision **importante** le code source de tout ce qui est utilisÃ© pour ce POC est disponible sur [Github](https://github.com/toorop/khao).

Nâ€™hÃ©sitez pas Ã  y jeter un coup dâ€™oeil pour vous assurer que je nâ€™ai pas insÃ©rÃ© un script pour miner des moneros ;)

### Installer lâ€™extension sous Chrome

- commencez par [tÃ©lÃ©charger le zip](https://github.com/toorop/khao/releases/download/0.1.1/khao-0.1.1.zip) contenant lâ€™extension.
- dÃ©compressez le zip
- ouvrez chrome Ã  lâ€™adresse ```chrome://extensions/```, activez le mode developpeur et cliquez sur le bouton â€œcharger lâ€™extension non empaquetÃ©eâ€¦â€:

![installation de Khao sous chrome - etape 1 ](/images/2018/03/4/chrome-1.png#center)

- indiquez le rÃ©pertoire ou se trouve lâ€™extension et validez.
- si vous avez dÃ©jÃ  des â€œbloqueurs de publicitÃ©sâ€ je vous conseille dâ€™activer lâ€™option: â€œAutoriser en mode navigation privÃ©eâ€ et de surfer de temps Ã  autre sous ce mode.

![installation de Khao sous chrome - etape 2 ](/images/2018/03/4/chrome-2.png#center)

- si vous voulez voir les logs de lâ€™extension cliquez sur â€œpage en arriÃ¨re-planâ€

### Installer lâ€™extension sous Firefox

- commencez par [tÃ©lÃ©charger le zip](https://github.com/toorop/khao/releases/download/0.1.1/khao-0.1.1.zip) contenant lâ€™extension.
- dÃ©compressez le zip
- entrez dans la barre dâ€™adresse: ```about:debugging```
- cliquez sur â€œcharger un module temporaireâ€
- contrairement Ã  chrome, il vous faudra ici indiquer que l'adresse du fichier â€œmanifest.jsonâ€
- si vous souhaitez avoir des info de debug il vous suffit de cliquer sur â€œActiver le dobogage des modulesâ€

### Mode dâ€™emploi

VoilÃ  vous devriez avoir Ã  droite de votre barre de navigation un nouvel icÃ´ne triangulaire jaune. Par dÃ©faut le switch de cookies est activÃ©. Si vous souhaitez le dÃ©sactiver, il vous suffit de cliquer sur lâ€™icÃ´ne, il va devenir gris. Un nouveau clic sur lâ€™icÃ´ne va rÃ©activer la fonctionnalitÃ©e.

Ne vous attendez Ã  rien d'extraordinaire, en toute logique de votre cotÃ©, pour le moment en tout cas, vous n'aller rien constater. De son cotÃ© l'ami google lui, devrait voir quelques incohÃ©rences dans les info remontÃ©es. A terme, quand par exemple on ferra la mÃªme chose sur les cookie des annonceurs, lÃ  on devrait avoir un peu plus de retours de notre cotÃ© en voyant par exemple des publicitÃ©s n'ayant aucun rapport avec nos centres d'interets.

Pour le moment il nâ€™y a rien dâ€™implÃ©mentÃ© concernant les mises Ã  jour, je les signalerais sur mon [compte twitter](https://twitter.com/poroot).

Si vous avez besoin dâ€™informations complÃ©mentaires, nâ€™hÃ©sitez pas Ã  me contacter, par exemple via [Discord](https://discord.toorop.fr)

## Participez au projet

![help](/images/2018/03/4/weneedyou.jpg#center)

Si vous voulez filer un coup de main nâ€™hÃ©sitez pas. En particulier si vous:

- Ãªtes dÃ©veloppeur javascript, ce nâ€™est pas ma spÃ©cialitÃ© et donc je suis certain quâ€™il a pas mal dâ€™amÃ©liorations Ã  faire.
- Ãªtes Ã  lâ€™aise avec lâ€™anglais pour rÃ©diger de la doc.
- avez de connaissance sur le tracking.
- avez juste envie.

Dans tous les cas contactez moi et/ou faites des pull-request sur [Github](https://github.com/toorop/khao/)

Et puis n'hÃ©sitez pas Ã  partager cet article, il est important d'avoir des testeurs, des avis, des retours, des...

Voila en espÃ©rant que la suite ne soit pas celle envisagÃ©e par Martin ;)

<div align="center">
<blockquote class="twitter-tweet" data-conversation="none" data-lang="fr"><p lang="fr" dir="ltr">Je me demande quels seraient d&#39;Ã©ventuels recours de ceux qui dÃ©posent les pisteurs contre ceux qui les falsifient. (Atteinte Ã  un systÃ¨me de traitement automatisÃ© ? usurpation d&#39;identitÃ© ? autre ?) ğŸ™ƒ</p>&mdash; Martin (@martin1975) <a href="https://twitter.com/martin1975/status/967676459937681410?ref_src=twsrc%5Etfw">25 fÃ©vrier 2018</a></blockquote>
<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
</div>

